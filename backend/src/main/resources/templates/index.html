<!DOCTYPE html>
<html lang="en"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
  <meta charset="UTF-8">
  <title th:text="${title}">Zipp</title>


  <style>
    #map {
      height: 600px;
      width: 100%;
      margin-top: 20px;
    }
  </style>

</head>

<body>
<main>

  <div class="welcome" layout:fragment="welcome">
    <h1 class="welcome__title">
      Welcome
      <span th:if="${isLoggedIn}" th:text="${userName}"></span>
    </h1>
    <p class="welcome__text" th:unless="${isLoggedIn}"> Please log in to make a report</p>


    <div id="map"></div>
  </div>
</main>


<div layout:fragment="scripts">
  <script>
    function initMap() {

      const defaultLocation = { lat: 59.3293, lng: 18.0686 }; //  (Stockholm)

      function loadMap(center) {
        const map = new google.maps.Map(document.getElementById("map"), {
          center: center,
          zoom: 12
        });

        new google.maps.Marker({
          position: center,
          map: map,
          title: "You are here"
        });
      }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            loadMap(userLocation);
          },
          (error) => {
            console.warn("Location denied.Showing Stockholm instead.");
            loadMap(defaultLocation);
          }
        );
      } else {
        console.warn("Geolocation are not approved. Showing Stockholm.");
        loadMap(defaultLocation);
      }
    }
  </script>



  <script async defer
          th:src="@{'https://maps.googleapis.com/maps/api/js?key=' + ${googleApiKey} + '&callback=initMap'}"
          onerror="onGoogleMapsLoadError()">
  </script>
</div>

</body>
</html>



